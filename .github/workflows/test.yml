name: test
on:
  workflow_dispatch:
jobs:
  RM_Pipeline:
    runs-on: self-hosted
    strategy:
      matrix:
        node-version: [14.x]
    steps:
       - uses: actions/checkout@v2
       - name: Use Node.js ${{ matrix.node-version }}
         uses: actions/setup-node@v2
         with:
           node-version: ${{ matrix.node-version }}
       - name: Set up CF CLI
         uses: jvalkeal/setup-cf-cli@v0
         with:
           version: 6.51.0
       - name: Deploy
         run: |
           echo 'y' | cf install-plugin multiapps
           cf login -a $CF_API -u $CF_USERNAME -o $CF_ORG -s $CF_SPACE -p $CF_PASSWORD
         env:
           CF_API: ${{ secrets.CF_API }}
           CF_ORG: ${{ secrets.CF_ORG }}
           CF_SPACE: ${{ secrets.CF_SPACE }}
           CF_USERNAME: ${{ secrets.CF_USERNAME }}
           CF_PASSWORD: ${{ secrets.CF_PASSWORD }}
       - name: Integration-test
         run: |
           appId=`cf app cpapp-srv --guid`
           `cf curl /v2/apps/$appId/env > tests/appEnv.json`
           chmod 777 tests/appEnv.json
           cat tests/appEnv.json
       
       - name: Update my-file.json description
         uses: jossef/action-set-json-field@v1
         with:
           file: tests/appEnv.json
           field: pusername
           value: ${{ secrets.CF_USERNAME }}
         run: |
           cat tests/appEnv.json
           
